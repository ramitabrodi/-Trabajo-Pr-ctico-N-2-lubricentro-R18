<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="../img/favicon.ico">
  <title>Comprar - Lubricentro R/18</title>
  <link rel="stylesheet" href="../css/styles.css">

</head>
<body>
  <header>
    <nav class="navbar">
      <div class="nav-container">
        <h1 class="logo">Lubricentro R/18</h1>
        <ul class="nav-menu">
          <li><a href="../index.html" class="nav-link">Inicio</a></li>
          <li><a href="listado_tabla.html" class="nav-link">Productos (Tabla)</a></li>
          <li><a href="listado_box.html" class="nav-link">Productos (Cajas)</a></li>
          <li><a href="comprar.html" class="nav-link active">Comprar</a></li>
          <li><a href="carrito.html" class="nav-link">üõí Carrito (<span id="cart-count">0</span>)</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <main>
    <h2>Formulario de Compra</h2>
    
    <!-- Informaci√≥n del carrito (se muestra cuando viene desde carrito) -->
    <div id="info-carrito" class="info-carrito">
      <!-- Se llena autom√°ticamente con JavaScript -->
    </div>

    <form id="purchaseForm" novalidate>
      <label for="nombre">Nombre completo</label>
      <input type="text" id="nombre" name="nombre" placeholder="Ej: Juan P√©rez" required>
      <div id="error-nombre" class="error">‚ö† Solo se permiten letras y espacios.</div>

      <label for="direccion">Direcci√≥n</label>
      <input type="text" id="direccion" name="direccion" placeholder="Ej: Av. Siempre Viva 742" required>

      <label for="telefono">Tel√©fono</label>
      <input type="tel" id="telefono" name="telefono" placeholder="Ej: 1156784321" required>
      <div id="error-telefono" class="error">‚ö† Solo se permiten n√∫meros (7-15 d√≠gitos).</div>

      <label for="email">Correo electr√≥nico</label>
      <input type="email" id="email" name="email" placeholder="Ej: usuario@gmail.com" required>
      <div id="error-email" class="error">‚ö† Ingrese un correo v√°lido (ej: ejemplo@dominio.com).</div>

      <label for="producto">Producto a comprar</label>
      <select id="producto" name="producto" required>
        <option value="">Seleccione un producto...</option>
        <option value="Aceite Motor Mineral">Aceite Motor Mineral</option>
        <option value="Aceite Motor Sint√©tico">Aceite Motor Sint√©tico</option>
        <option value="Filtro de Aceite">Filtro de Aceite</option>
        <option value="Filtro de Aire">Filtro de Aire</option>
        <option value="Filtro de Combustible">Filtro de Combustible</option>
      </select>

      <label for="cantidad">Cantidad</label>
      <input type="number" id="cantidad" name="cantidad" min="1" max="10" value="1">

      <!-- M√âTODO DE PAGO -->
      <div class="metodo-pago">
        <label><strong>M√©todo de pago:</strong></label>

        <div class="opcion">
          <span>Tarjeta de cr√©dito/d√©bito</span>
          <input type="radio" name="metodoPago" value="Tarjeta de cr√©dito/d√©bito" required>
        </div>

        <div class="opcion">
          <span>Transferencia bancaria</span>
          <input type="radio" name="metodoPago" value="Transferencia bancaria">
        </div>

        <div class="opcion">
          <span>Efectivo</span>
          <input type="radio" name="metodoPago" value="Efectivo">
        </div>

        <div id="error-metodo" class="error">‚ö† Seleccione un m√©todo de pago.</div>
      </div>

      <!-- Barra de progreso -->
      <div class="progress-bar">
        <div class="progress-bar-fill" id="progress-bar-fill"></div>
      </div>

      <button type="submit" class="btn btn-primary">Enviar Pedido</button>
    </form>

    <!-- Enlace para volver al carrito -->
    <div style="text-align: center; margin-top: 2rem;">
      <a href="carrito.html" class="btn btn-secondary">‚Üê Volver al Carrito</a>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 Lubricentro R/18 - Todos los derechos reservados</p>
      <p>Direcci√≥n: Av. Principal 123, Ciudad | Tel√©fono: (011) 4567-8900 | Email: info@lubricentror18.com</p>
    </div>
  </footer>

  <div class="notification" id="notification">‚úÖ Pedido enviado correctamente.</div>

  <script src="../js/app.js"></script>
  <script>
    // Inicializaci√≥n espec√≠fica para esta p√°gina
    document.addEventListener('DOMContentLoaded', function() {
      actualizarContadorCarrito();
      
      // Verificar si viene desde carrito y mostrar mensaje
      const compraDesdeCarrito = sessionStorage.getItem('compraDesdeCarrito');
      if (compraDesdeCarrito === 'true') {
        const carritoParaCompra = sessionStorage.getItem('carritoParaCompra');
        if (carritoParaCompra) {
          const carrito = JSON.parse(carritoParaCompra);
          const infoDiv = document.getElementById('info-carrito');
          if (infoDiv) {
            const totalItems = carrito.reduce((acc, item) => acc + (item.cantidad || 1), 0);
            infoDiv.innerHTML = `
              <strong>üì¶ Compra desde carrito:</strong> 
              ${carrito.length} producto(s) - ${totalItems} item(s) total
              <br><small>Tus productos han sido cargados autom√°ticamente. Puedes editar los datos personales.</small>
            `;
            infoDiv.style.display = 'block';
          }
        }
      }

      const form = document.getElementById('purchaseForm');
      const progressFill = document.getElementById('progress-bar-fill');
      
      if (form && progressFill) {
        const inputs = form.querySelectorAll('input, select');
        
        function actualizarProgreso() {
          let completados = 0;
          inputs.forEach(input => {
            if (input.type === 'radio') {
              // Para radios, verificamos si alguno del grupo est√° seleccionado
              const radioGroup = document.querySelectorAll(`input[name="${input.name}"]`);
              const algunoSeleccionado = Array.from(radioGroup).some(radio => radio.checked);
              if (algunoSeleccionado) completados++;
            } else if (input.value.trim() !== '') {
              completados++;
            }
          });
          
          // Ajustamos porque los radios se cuentan como un solo campo
          const camposUnicos = new Set(Array.from(inputs).map(input => input.name));
          const porcentaje = (completados / camposUnicos.size) * 100;
          progressFill.style.width = porcentaje + '%';
        }
        
        // Agregar eventos a todos los inputs
        inputs.forEach(input => {
          if (input.type === 'radio') {
            input.addEventListener('change', actualizarProgreso);
          } else {
            input.addEventListener('input', actualizarProgreso);
          }
        });
        
        // Inicializar progreso
        actualizarProgreso();

        // Manejar el env√≠o del formulario
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // Validaciones b√°sicas
          let valido = true;
          const nombre = document.getElementById('nombre');
          const telefono = document.getElementById('telefono');
          const email = document.getElementById('email');
          const producto = document.getElementById('producto');
          const metodoPago = document.querySelector('input[name="metodoPago"]:checked');

          // Validar nombre (solo letras y espacios)
          if (!/^[a-zA-Z√Ä-√ø\s]{2,}$/.test(nombre.value.trim())) {
            document.getElementById('error-nombre').style.display = 'block';
            valido = false;
          } else {
            document.getElementById('error-nombre').style.display = 'none';
          }

          // Validar tel√©fono (solo n√∫meros)
          if (!/^[0-9]{7,15}$/.test(telefono.value.trim())) {
            document.getElementById('error-telefono').style.display = 'block';
            valido = false;
          } else {
            document.getElementById('error-telefono').style.display = 'none';
          }

          // Validar email
          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())) {
            document.getElementById('error-email').style.display = 'block';
            valido = false;
          } else {
            document.getElementById('error-email').style.display = 'none';
          }

          // Validar m√©todo de pago
          if (!metodoPago) {
            document.getElementById('error-metodo').style.display = 'block';
            valido = false;
          } else {
            document.getElementById('error-metodo').style.display = 'none';
          }

          // Validar producto seleccionado
          if (producto.value === '') {
            producto.style.borderColor = '#c0392b';
            valido = false;
          } else {
            producto.style.borderColor = '';
          }

          if (!valido) {
            mostrarNotificacion('Por favor completa correctamente todos los campos', 'error');
            return;
          }

          // Si todo es v√°lido, mostrar confirmaci√≥n
          const notification = document.getElementById('notification');
          notification.textContent = '‚úÖ Pedido enviado correctamente';
          notification.classList.add('show');
          
          setTimeout(() => {
            notification.classList.remove('show');
          }, 3000);

          // Limpiar formulario
          form.reset();
          progressFill.style.width = '0%';

          // Si ven√≠a desde carrito, limpiar sessionStorage
          if (compraDesdeCarrito === 'true') {
            sessionStorage.removeItem('compraDesdeCarrito');
            sessionStorage.removeItem('carritoParaCompra');
          }
        });
      }
    });
  </script>
</body>
</html>